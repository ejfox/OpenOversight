{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block content %}
<div class="container pa1 pa4-l pt0 w-80-l center" role="main">
  {% if from_search %}
    <h1>No Results Found</h1>
    <h4>Sorry, no officers found for your search! <a href="/find">Try again</a></h4>
    <h2>Other Officers from {{ department.name|title }}</h2>
  {% else %}
    <h1>
      {{ department.name|title }} Officers
    </h1>
  {% endif %}
    <div class="bt bb pa2">
      <h4 class="ma0 mt2 pa0">Filter officers</h4>
      <form class="form ma0" method="get" role="form">
         <div class="browse-form-input" data-value="{{ race }}">
          {{ wtf.form_field(form.race) }}
        </div>
        <div class="browse-form-input" data-value="{{ gender }}">
          {{ wtf.form_field(form.gender) }}
        </div>
        <div class="browse-form-input" data-value="{{ rank }}">
          {{ wtf.form_field(form.rank) }}
        </div>
        <div class="browse-form-input" data-value="{{ min_age }}">
          {{ wtf.form_field(form.min_age) }}
          {{ wtf.form_field(form.min_age).label }}
        </div>
        <div class="browse-form-input" data-value="{{ max_age }}">
          {{ wtf.form_field(form.max_age) }}
        </div>

        <div class="f2 mv2">
          {{ wtf.form_field(form.submit, id="submit", button_map={'submit':'primary'}) }}
        </div>
    </div>
  {% with paginate=officers,
          next_url=url_for('main.list_officer', department_id=department.id, page=officers.next_num,
        from_search=from_search, race=race, gender=gender, rank=rank, min_age=min_age, max_age=max_age),
          prev_url=url_for('main.list_officer', department_id=department.id, page=officers.prev_num,
          from_search=from_search, race=race, gender=gender, rank=rank, min_age=min_age, max_age=max_age),
          location='top' %}
    {% include "partials/paginate_nav.html" %}
  {% endwith %}
  <ul class="list-group pa0 ma0 list">
    {% for officer in officers.items %}
      {% if officer.face.first() is none %}
          {% set officer_image = '/static/images/placeholder.png' %}
        {% else %}
          {% set officer_image = officer.face.first().image.filepath %}
        {% endif %}
      {% set assignment = officer.assignments.first() %}
      <li class="list-group-item">
          <div class="row cf f3-ns mv4 mv5-l">
            <div class="">
              <h2 class="f1-l mv1 pa0">
                <a class="link black underline" href="{{ url_for('main.officer_profile', officer_id=officer.id) }}" id="officer-profile-{{ loop.index }}">{% include "partials/officer_name.html" %}</a>
                <span class="gray ml2-ns">#{{ assignment.star_no }}</span>
              </h2>

              <img src="{{ officer_image }}" class="pa2 w-40 fl ba b--light-gray bg-white mr2 mr4-l" alt="{% include 'partials/officer_name.html' %}">

              <div class="row w-50 fl pa0 ma0 mt4-ns lh-copy">
                <div class="fl w-50">
                  <dl class="ma0 pa0">
                    <dt class="b lh-title">Rank</dt>
                    <dd class="ml0">{{ assignment.rank|default('Unknown') }}</dd>
                    <dt class="b lh-title mt4-ns">Race</dt>
                    <dd class="ml0">{{ officer.race|default('Unknown')|lower|title }}</dd>
                  </dl>
                </div>
                <div class="fl w-50 pa0">
                  <dl class="ma0 pa0">
                    <dt class="b lh-title">Gender</dt>
                    <dd class="ml0">{{ officer.gender|default('Unknown') }}</dd>
                    <dt class="b lh-title mt4-ns">Number of Photos</dt>
                    <dd class="ml0">{{ officer.face.count() }}</dd>
                  </dl>
                </div>
              </div>
            </div>
          </div>
      </li>
    {% endfor %}
  </ul>

  {% with paginate=officers,
          next_url=url_for('main.list_officer', department_id=department.id, page=officers.next_num,
        from_search=from_search, race=race, gender=gender, rank=rank, min_age=min_age, max_age=max_age),
          prev_url=url_for('main.list_officer', department_id=department.id, page=officers.prev_num,
          from_search=from_search, race=race, gender=gender, rank=rank, min_age=min_age, max_age=max_age),
          location='bottom' %}
    {% include "partials/paginate_nav.html" %}
  {% endwith %}
</div>
<script>
$('.browse-form-input').each(function(i) {
  $(this).find('select').val($(this).data('value'));
});
</script>Â¬
</form>
{% endblock content %}
